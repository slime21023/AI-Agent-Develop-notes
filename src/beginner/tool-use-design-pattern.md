# Tool Use 設計模式

## 核心概念：工具使用設計模式 (Tool Use Design Pattern)

**定義**：此模式旨在賦予大型語言模型 (LLM) 與外部工具互動的能力，以達成特定目標。

**工具**：指可由 AI 代理 (Agent) 執行的程式碼，範圍可從簡單的計算機功能到呼叫第三方服務 API (如：查詢股價、天氣預報)。

**目的**：擴展 AI 代理的能力範圍，使其能執行更多樣化的動作。

## 主要機制：函數/工具呼叫 (Function/Tool Calling)

**運作方式**：
1.  開發者提供 LLM 一個包含可用函數/工具描述的結構 (Schema)。
2.  LLM 根據使用者請求，比對 Schema，選擇最適合的函數/工具。
3.  LLM 回傳所選函數的名稱及所需參數 (形成一個 "Tool Call")。
4.  外部程式碼執行該函數/工具。
5.  執行結果回傳給 LLM。
6.  LLM 根據執行結果生成最終回覆給使用者。

**必要條件**：
1.  支援函數呼叫的 LLM 模型 (如 Azure OpenAI)。
2.  包含函數描述的 Schema (通常是 JSON 格式)。
3.  實際執行的函數程式碼。

## 應用場景

*   **動態資訊檢索**：查詢 API 或資料庫以獲取最新數據 (例如：天氣、股價、資料分析)。
*   **程式碼執行與解釋**：執行程式碼解決數學問題、生成報告或進行模擬。
*   **工作流程自動化**：整合任務排程器、郵件服務或數據管道，自動化多步驟流程。
*   **客戶支援**：與 CRM 系統、工單平台或知識庫互動以解決用戶查詢。
*   **內容生成與編輯**：利用文法檢查、文本摘要或內容安全評估等工具輔助內容創作。

## 實作要素/建構模塊

*   **函數/工具呼叫**：核心機制，讓 LLM 能與工具互動。
*   **動態資訊檢索能力**：使代理能查詢外部 API 或資料庫。
*   **程式碼執行與解釋能力**：使代理能運行腳本解決問題。
*   **工作流程自動化能力**：整合不同工具完成複雜任務。
*   **客戶支援互動能力**：與相關系統對接。
*   **內容生成與編輯輔助能力**：利用特定工具改善內容品質。

## 代理框架範例 (Agentic Frameworks)

**目的**：簡化工具使用的實作，提供預建構的模塊。

**Semantic Kernel**：
*   開源框架 (支援 .NET, Python, Java)。
*   自動將函數及其參數序列化 (serializing) 成 Schema 給模型。
*   處理模型與程式碼之間的溝通。
*   將函數/工具稱為 "Plugins"。
*   提供預建工具如檔案搜尋 (File Search)、程式碼解釋器 (Code Interpreter)。

**Azure AI Agent Service**：
*   較新的託管服務 (Managed Service)，適合企業應用。
*   自動化工具呼叫流程 (無需自行解析 Tool Call、調用工具、處理回應)。
*   安全地管理對話狀態 (使用 Threads)。
*   提供開箱即用的工具 (知識工具：Bing 搜尋、檔案搜尋、Azure AI Search；動作工具：函數呼叫、程式碼解釋器、Azure Functions 等)。
*   允許將多個工具組合成 `toolset`。

## 建立可信賴 AI 代理的特殊考量

**安全性**：當 LLM 動態生成 SQL 查詢時，需注意 SQL 注入或惡意操作 (如刪除資料庫) 的風險。

**緩解措施**：
*   **權限控管**：為應用程式設定資料庫的唯讀權限 (例如，僅授予 SELECT 權限)。
*   **安全環境**：在安全的環境中運行應用程式。
*   **數據架構**：在企業場景中，通常將數據抽取轉換到唯讀的資料庫或數據倉儲，並使用對使用者友善的 Schema，確保應用程式只有受限的唯讀存取權。
