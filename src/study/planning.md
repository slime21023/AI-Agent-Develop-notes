# 規劃能力與任務分解

在面對複雜或多階段的任務時，單次生成往往難以兼顧全局與細節。

**規劃 (Planning)** 能在任務開始前構思多步路徑；

**分解 (Decomposition)** 將高階目標切分為可執行子任務；

**自我優化 (Self‑Optimization)** 則透過反覆迭代與評估，持續修正與提昇。  

---

## 核心設計要點

1. 規劃（多步前瞻）  
   - 生成多條思路（Thought Chains）或路徑（Paths）  
   - 透過啟發式或模型評分機制，篩選最有前景的方案  

2. 分解（細化執行）  
   - 將高階目標拆解為明確子任務  
   - 定義子任務輸入、輸出與依賴關係  
   - 串聯 Pipeline 或多 Agent 協同完成  

3. 自我優化（迭代反饋）  
   - 初次生成後，根據結果自我評估（自我反思）  
   - 動態微調 Prompt、參數或策略  
   - 記錄歷史決策與成敗案例，作為下一輪優化依據  

4. 可靠性保證  
   - 在規劃階段引入風險評估（Risk Assessment）  
   - 在分解與執行過程中實施檢查點（Checkpoints）  
   - 自我優化時加入錯誤回滾（Rollback）與異常處理  

---

## 代表性方法

| 名稱                            | 核心機制                                     | 適用場景                                                |
| ------------------------------- | -------------------------------------------- | ------------------------------------------------------- |
| **Tree‑of‑Thought (ToT)**  | 多路徑推理＋回溯選擇                           | 高難度推理、策略遊戲、複雜決策規劃                       |
| **SELF‑REFINE**            | 自我反思＋迭代生成                             | 內容生成校正、程式碼修正、減少幻覺                        |
| **RLCD**                   | 強化學習（RL）＋對比蒸餾（Contrastive Distill） | 長期任務優化、策略學習、決策品質提升                     |

### Tree‑of‑Thought (ToT)
- **流程**  
  1. 同時展開多條「思維樹枝」（Thought Branches）  
  2. 對每條路徑進行啟發式評分（Heuristic Scoring）  
  3. 回溯（Backtrack）並選擇最高分支繼續深化  
- **優勢**  
  - 支援複雜、多步驟推理  
  - 類似搜索演算法，易於納入啟發函數或外部知識  
- **挑戰**  
  - 分支爆炸需管控深度與寬度  
  - 評分函數設計決定最終效果

### SELF‑REFINE
- **流程**  
  1. 初次生成回答或解法  
  2. 自我評估（Self‑Critique）：檢查邏輯漏洞、格式錯誤  
  3. 生成「改進指令」並重新生成答案  
- **優勢**  
  - 明顯降低錯誤率與幻覺  
  - 無需額外訓練，即可作為提示工程層級的優化器  
- **挑戰**  
  - 評估標準與自評模板需精心設計  
  - 反覆迭代成本較高

### RLCD
- **流程**  
  1. 以強化學習（RL）優化決策策略  
  2. 引入對比蒸餾（Contrastive Distillation）對齊高質量示例  
  3. 在生成時結合 RL 探索與蒸餾後的模式  
- **優勢**  
  - 結合探索（Exploration）與範例對齊（Expert Alignment）  
  - 可在動態環境中持續學習與優化  
- **挑戰**  
  - 需設計合適的回饋函數（Reward Function）  
  - 訓練成本與樣本質量需平衡

---

## 實踐建議

1. 小步快跑  
   - 先構建「簡易版規劃 → 分解 → 自評 → 重試」閉環，進行 PoC  
   - 觀察迭代次數、時間成本與結果品質  

2. 限制分支  
   - 設定最大規劃深度與分支數，避免資源耗盡  
   - 依據任務難度動態調整（如早期少分支、後期細化）  

3. 評估指標  
   - 正確率（Accuracy）、執行效率（Latency）、迭代次數（Iterations）  
   - 自評質量：引入外部評估器（如另一個 LLM）審核自評結果  

4. 系統整合  
   - 規劃階段：可結合知識圖譜/外部規則引擎  
   - 分解與執行：採用多 Agent 或微服務架構並行處理  
   - 自我優化：記錄每次迭代軌跡，並定期分析失敗模式  

---  

透過**規劃**確立多步策略、**分解**保證每步可控、**自我優化**持續提升質量，Agent 不僅能在初始輸入下給出較完整的方案，也能在執行過程中反覆修正，最終輸出更可靠、效率更高的結果。