# 記憶機制與知識增強

在多步推理、長期任務或開放域問答場景中，單純依賴 LLM 的短期上下文（Context Window）往往會導致「遺忘」或「知識不足」。透過**記憶機制**與**知識增強**，Agent 能夠跨會話／跨任務地保存重要資訊、動態檢索外部知識，並在需求時融入生成過程，提升可靠度與靈活性。  

---

## 記憶機制設計要點

1. **短期記憶（Working Memory）**  
   - 保持當前會話或任務流程中的關鍵上下文，如前序對話摘要、臨時變量、決策歷程。  
   - 策略：Sliding window、摘要壓縮（Summarization）、關鍵訊息標記。  

2. **長期記憶（Long-Term Memory）**  
   - 跨會話保存使用者偏好、專業知識、任務歷史。  
   - 儲存格式：純文本、Embedding 向量、知識圖譜（Knowledge Graph）。  

3. **記憶檢索策略**  
   - 基於相似度：利用向量資料庫（如 FAISS、Weaviate）檢索最相關記憶。  
   - 基於結構：查詢知識圖譜中的節點與關聯。  
   - 在線更新：根據最新輸入動態增補或刪除記憶。  

4. **記憶整合與篩選**  
   - 避免「信息爆炸」：定期蒐總並精簡冗余記憶（Memory Pruning）。  
   - 重要性評估：採用檢索-評估-排序閉環，保障高質量記憶參與生成。  

5. **安全與隱私**  
   - 敏感資訊標記、加密存儲與存取控制。  
   - 日誌稽核：記錄記憶更新與檢索行為，確保可追溯。

---

## 代表性機制與框架／論文

| 名稱                | 核心機制                                  | 應用場景                                           |
| ------------------- | ----------------------------------------- | -------------------------------------------------- |
| **ReAct**           | 推理（Reasoning）＋行動（Acting）閉環      | 多步推理、動態決策，如程式修正、問答導覽              |
| **Voyager**         | 在線探索＋技能存儲＋長期記憶累積           | 自主學習型環境（Minecraft），任務技能自我成長          |
| **RAG**             | 檢索（Retrieval）＋生成（Generation）結合  | 大規模知識庫問答、最新資料融入、跨領域資訊融合          |

### ReAct
- **架構**：在每個生成步驟中，同步執行  
  1. 「思考（Thought）」：產生內部推理鏈（Chain‑of‑Thought）  
  2. 「行動（Action）」：調用工具或檢索外部資料  
  3. 「反饋（Observation）」：將行動結果納入下一輪思考  
- **優勢**：  
  - 支援多步動態任務；  
  - 顯式暴露推理過程，易於錯誤診斷。

### Voyager
- **架構**：  
  1. **探索 Agent**：在 Minecraft 世界自動執行任務（如採礦、建築）  
  2. **技能模組**：將成功操作序列抽象為高階技能  
  3. **長期記憶庫**：以向量化或程式碼片段形式累積已學技能  
- **優勢**：  
  - 自主發現與學習，適合開放環境；  
  - 長期累積技能，提升後續任務效率。

### RAG (Retrieval‑Augmented Generation)
- **架構**：  
  1. **檢索器**：對外部知識庫（文檔庫、Wiki、公司內部資料）進行向量檢索  
  2. **融合器**：將檢索到的證據段落拼接至提示詞（Prompt）  
  3. **生成器**：在增強提示詞基礎上生成最終回應  
- **優勢**：  
  - 突破模型知識截止時間；  
  - 精準引用來源，減少幻覺。

---

## 實踐建議

- **場景選型**  
  - 開放域問答 → 優先採用 RAG 結合大規模向量庫。  
  - 流程型任務（程式除錯、跨文檔梳理）→ 選用 ReAct 以串聯工具調用與推理。  
  - 自主探索／長期學習 → 借鑑 Voyager 的技能抽象與累積機制。  

- **系統整合**  
  1. 選擇適合的向量資料庫（FAISS／Chroma／Weaviate）並設定檢索參數（Top‑k、過濾條件）。  
  2. 設計記憶更新策略：何時自動存入、何時人工審核；  
  3. 定期壓縮與精煉記憶：使用摘要模型或指標驅動清理。  

- **持續迭代**  
  - 監控「檢索命中率」與「生成可信度」指標；  
  - 根據實際反饋調整檢索策略（重排、再檢索）與記憶保留週期。

透過以上設計與實踐，可構建具備短期上下文維護、長期知識累積與動態檢索能力的智慧 Agent，不僅提升任務完成度，並顯著降低內容錯誤與遺忘風險。